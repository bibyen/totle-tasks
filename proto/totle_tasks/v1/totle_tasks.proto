syntax = "proto3";

package totle_tasks.v1;

import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/bibyen/totle-tasks/internal/pb/totle_tasks/v1;totletasksv1";

// GoalService manages individual user objectives and CRUD operations for goal tracking.
service GoalService {
  rpc CreateGoal(CreateGoalRequest) returns (CreateGoalResponse);
  rpc GetGoal(GetGoalRequest) returns (GetGoalResponse);
  rpc ListGoals(ListGoalsRequest) returns (ListGoalsResponse);
  rpc UpdateGoal(UpdateGoalRequest) returns (UpdateGoalResponse);
  rpc DeleteGoal(DeleteGoalRequest) returns (DeleteGoalResponse);
}

// BingoService manages the gamified Bingo Card view of goals, organized by time periods.
service BingoService {
  // BingoService.CreateBingoCard explicitly creates a new bingo card for a specific period.
  rpc CreateBingoCard(CreateBingoCardRequest) returns (CreateBingoCardResponse);
  rpc GetBingoCard(GetBingoCardRequest) returns (GetBingoCardResponse);
  rpc UpdateBingoCard(UpdateBingoCardRequest) returns (UpdateBingoCardResponse);
}

/*
 * =========================
 * Resources (Nouns)
 * =========================
 */

message Goal {
  option (google.api.resource) = {
    type: "totletasks.googleapis.com/Goal"
    pattern: "goals/{goal}"
  };

  string name = 1 [(google.api.field_behavior) = OUTPUT_ONLY];
  string title = 2 [(google.api.field_behavior) = REQUIRED];
  bool completed = 3;
  bool is_assigned = 4 [(google.api.field_behavior) = OUTPUT_ONLY];

  enum Visibility {
    VISIBILITY_UNSPECIFIED = 0;
    VISIBILITY_PRIVATE = 1;
    VISIBILITY_FRIENDS = 2;
    VISIBILITY_PUBLIC = 3;
  }
  Visibility visibility = 5;
  bool is_archived = 6 [(google.api.field_behavior) = OUTPUT_ONLY];
  google.protobuf.Timestamp create_time = 7 [(google.api.field_behavior) = OUTPUT_ONLY];
  google.protobuf.Timestamp update_time = 8 [(google.api.field_behavior) = OUTPUT_ONLY];
}

message BingoCard {
  option (google.api.resource) = {
    type: "totletasks.googleapis.com/BingoCard"
    pattern: "bingoCards/{bingo_card}"
  };

  string name = 1;
  
  message Slot {
    string goal = 1;
    Goal goal_value = 2;
  }

  message GridRow {
    repeated Slot slots = 1;
  }

  repeated GridRow grid = 2;
  int32 year = 3;
  int32 month = 4;
  google.protobuf.Timestamp update_time = 5;
  google.protobuf.Timestamp create_time = 6 [(google.api.field_behavior) = OUTPUT_ONLY];
}

/*
 * =========================
 * Request/Response Messages
 * =========================
 */

// --- Bingo Card Messages ---

message CreateBingoCardRequest {
  // parent is the user resource name (e.g., "users/123").
  string parent = 1 [(google.api.field_behavior) = REQUIRED];

  // bingo_card contains the initial state (year, month).
  BingoCard bingo_card = 2 [(google.api.field_behavior) = REQUIRED];
}

message CreateBingoCardResponse {
  BingoCard bingo_card = 1;
}

message GetBingoCardRequest {
  string name = 1 [(google.api.field_behavior) = REQUIRED];

  enum BingoCardView {
    BINGO_CARD_VIEW_UNSPECIFIED = 0;
    BINGO_CARD_VIEW_BASIC = 1;
    BINGO_CARD_VIEW_FULL = 2;
  }
  BingoCardView view = 2;
}

message GetBingoCardResponse {
  BingoCard bingo_card = 1;
}

message UpdateBingoCardRequest {
  BingoCard bingo_card = 1 [(google.api.field_behavior) = REQUIRED];
  google.protobuf.FieldMask update_mask = 2;
}

message UpdateBingoCardResponse {
  BingoCard bingo_card = 1;
}

// --- Goal Messages ---

message CreateGoalRequest {
  string parent = 1 [(google.api.field_behavior) = REQUIRED];
  Goal goal = 2 [(google.api.field_behavior) = REQUIRED];
  string goal_id = 3;
}

message CreateGoalResponse {
  Goal goal = 1;
}

message GetGoalRequest {
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "totletasks.googleapis.com/Goal"
  ];
}

message GetGoalResponse {
  Goal goal = 1;
}

message ListGoalsRequest {
  string parent = 1 [(google.api.field_behavior) = REQUIRED];
  int32 page_size = 2;
  string page_token = 3;
  string filter = 4;
}

message ListGoalsResponse {
  repeated Goal goals = 1;
  string next_page_token = 2;
}

message UpdateGoalRequest {
  Goal goal = 1 [(google.api.field_behavior) = REQUIRED];
  google.protobuf.FieldMask update_mask = 2;
}

message UpdateGoalResponse {
  Goal goal = 1;
}

message DeleteGoalRequest {
  string name = 1 [(google.api.field_behavior) = REQUIRED];
}

message DeleteGoalResponse {}
